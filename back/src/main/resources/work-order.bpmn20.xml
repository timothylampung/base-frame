<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns:flowable="http://flowable.org/bpmn"
             xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
             typeLanguage="http://www.w3.org/2001/XMLSchema"
             expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="Fixed">

    <process id="work_order_workflow" name="Work Order Workflow" isExecutable="true">
        <startEvent id="start"/>
        <sequenceFlow id="flow1.1" sourceRef="start" targetRef="workOrder_prepare_ST"/>
        <serviceTask id="workOrder_prepare_ST" name="prepare_ST"
                     flowable:expression="#{workOrder_prepare_ST.execute(execution)}"/>
        <sequenceFlow id="flow2.6a" sourceRef="workOrder_prepare_ST"
                      targetRef="workOrder_prepare_UT"/>

        <!--
               ====================================================================================================
               == STATE : REMOVED
               == SERVICE TASK : removed a bill invoice
               == USER TASK :
               ====================================================================================================
               -->
        <userTask id="workOrder_prepare_UT"
                  name="my.spotit.asset.workorder.domain.model.DexWorkOrder:PREPARED"
                  flowable:assignee="#{workOrderRouter.findPreparerAssignee(orderId)}"
                  flowable:candidateGroups="#{workOrderRouter.findPreparerCandidates(orderId)}">
        </userTask>
        <sequenceFlow id="flow2.3" sourceRef="workOrder_prepare_UT"
                      targetRef="workOrder_check_ST"/>

        <sequenceFlow id="flow2.4b" sourceRef="workOrder_prepare_UT"
                      targetRef="workOrder_remove_ST">
            <conditionExpression>${removeDecision}</conditionExpression>
        </sequenceFlow>
        <!--
               ====================================================================================================
               == STATE : REMOVED
               == SERVICE TASK : removed a bill invoice
               == USER TASK :
               ====================================================================================================
               -->
        <serviceTask id="workOrder_check_ST" name="check_ST"
                     flowable:expression="#{workOrder_check_ST.execute(execution)}"/>
        <sequenceFlow id="flow2.1" sourceRef="workOrder_check_ST"
                      targetRef="workOrder_check_UT"/>

        <userTask id="workOrder_check_UT"
                  name="my.spotit.asset.workorder.domain.model.DexWorkOrder:CHECKED"
                  flowable:assignee="#{workOrderRouter.findCheckerAssignee(orderId)}"
                  flowable:candidateGroups="#{workOrderRouter.findCheckerCandidates(orderId)}">
        </userTask>

        <sequenceFlow id="flow2.5" sourceRef="workOrder_check_UT"
                      targetRef="workOrder_verify_ST"/>

        <sequenceFlow id="flow2.4a" sourceRef="workOrder_check_UT"
                      targetRef="workOrder_remove_ST">
            <conditionExpression>${removeDecision}</conditionExpression>
        </sequenceFlow>
        <!--
                    ====================================================================================================
                    == STATE : REMOVED
                    == SERVICE TASK : removed a bill invoice
                    == USER TASK :
                    ====================================================================================================
                    -->
        <serviceTask id="workOrder_verify_ST" name="verify_ST"
                     flowable:expression="#{workOrder_verify_ST.execute(execution)}"/>
        <sequenceFlow id="flow2.6" sourceRef="workOrder_verify_ST"
                      targetRef="workOrder_verify_UT"/>

        <userTask id="workOrder_verify_UT"
                  name="my.spotit.asset.workorder.domain.model.DexWorkOrder:VERIFIED"
                  flowable:assignee="#{workOrderRouter.findVerifierAssignee(orderId)}"
                  flowable:candidateGroups="#{workOrderRouter.findVerifierCandidates(orderId)}">
        </userTask>
        <sequenceFlow id="flow2.7" sourceRef="workOrder_verify_UT"
                      targetRef="workOrder_maintain_ST"/>

        <sequenceFlow id="flow2.4c" sourceRef="workOrder_verify_UT"
                      targetRef="workOrder_remove_ST">
            <conditionExpression>${removeDecision}</conditionExpression>
        </sequenceFlow>
        <!--
            ====================================================================================================
            == STATE : REMOVED
            == SERVICE TASK : removed a bill invoice
            == USER TASK :
            ====================================================================================================
            -->

        <serviceTask id="workOrder_maintain_ST" name="maintain_ST"
                     flowable:expression="#{workOrder_maintain_ST.execute(execution)}"/>
        <sequenceFlow id="flow9.1" sourceRef="workOrder_maintain_ST" targetRef="workOrder_complete_ST"/>
        <serviceTask id="workOrder_complete_ST" name="complete_ST"
                     flowable:expression="#{workOrder_complete_ST.execute(execution)}"/>
        <sequenceFlow id="flow9.1c" sourceRef="workOrder_complete_ST" targetRef="end"/>

        <!--
                    ====================================================================================================
                    == STATE : REMOVED
                    == SERVICE TASK : removed a bill invoice
                    == USER TASK :
                    ====================================================================================================
                    -->
        <serviceTask id="workOrder_remove_ST" name="remove_ST"
                     flowable:expression="#{workOrder_remove_ST.execute(execution)}"/>
        <sequenceFlow id="flow9.1q" sourceRef="workOrder_remove_ST" targetRef="end"/>

        <endEvent id="end"/>
    </process>
</definitions>