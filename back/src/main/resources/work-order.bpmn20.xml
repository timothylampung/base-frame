<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns:flowable="http://flowable.org/bpmn"
             xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
             typeLanguage="http://www.w3.org/2001/XMLSchema"
             expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="Fixed">
    <process id="work_order_workflow" name="Work Order Workflow" isExecutable="true">
        <startEvent id="start"/>
        <sequenceFlow id="flow1.1" sourceRef="start" targetRef="workOrder_prepare_ST"/>
        <serviceTask id="workOrder_prepare_ST" name="prepare_ST"
                     flowable:expression="#{workOrder_prepare_ST.execute(execution)}"/>
        <sequenceFlow id="flow2.1" sourceRef="workOrder_prepare_ST"
                      targetRef="workOrder_prepare_UT"/>
        <userTask id="workOrder_prepare_UT"
                  name="my.spotit.asset.workorder.domain.model.DexWorkOrder:PREPARED"
                  flowable:assignee="#{workOrderRouter.findPreparedAssignee(orderId)}"
                  flowable:candidateGroups="#{workOrderRouter.findPreparedCandidates(orderId)}">
        </userTask>
        <sequenceFlow id="flow2.3" sourceRef="workOrder_prepare_UT"
                      targetRef="workOrder_check_ST"/>

        <serviceTask id="workOrder_check_ST" name="check_ST"
                     flowable:expression="#{workOrder_check_ST.execute(execution)}"/>
        <sequenceFlow id="flow2.4" sourceRef="workOrder_check_ST"
                      targetRef="workOrder_check_UT"/>
        <userTask id="workOrder_check_UT"
                  name="my.spotit.asset.workorder.domain.model.DexWorkOrder:CHECKED"
                  flowable:assignee="#{workOrderRouter.findCheckerAssignee(orderId)}"
                  flowable:candidateGroups="#{workOrderRouter.findCheckerCandidates(orderId)}">
        </userTask>

        <sequenceFlow id="flow2.5" sourceRef="workOrder_check_UT"
                      targetRef="workOrder_check_ST"/>
        <serviceTask id="workOrder_verify_ST" name="verify_ST"
                     flowable:expression="#{workOrder_verify_ST.execute(execution)}"/>
        <sequenceFlow id="flow2.6" sourceRef="workOrder_verify_ST"
                      targetRef="workOrder_verify_UT"/>
        <userTask id="workOrder_verify_UT"
                  name="my.spotit.asset.workorder.domain.model.DexWorkOrder:VERIFIED"
                  flowable:assignee="#{workOrderRouter.findVerifierAssignee(orderId)}"
                  flowable:candidateGroups="#{workOrderRouter.findVerifierCandidates(orderId)}">
        </userTask>
        <sequenceFlow id="flow2.7" sourceRef="workOrder_check_UT"
                      targetRef="workOrder_approve_ST"/>
        <serviceTask id="workOrder_approve_ST" name="approve_ST"
                     flowable:expression="#{workOrder_approve_ST.execute(execution)}"/>
        <sequenceFlow id="flow9.1" sourceRef="workOrder_approve_ST" targetRef="workOrder_complete_ST"/>
        <serviceTask id="workOrder_complete_ST" name="complete_ST"
                     flowable:expression="#{workOrder_complete_ST.execute(execution)}"/>
        <endEvent id="end"/>
    </process>
</definitions>